{"version":3,"file":"vue.js","sources":["../../src/utils/index.js","../../src/Hijack/arrMethods.js","../../src/Hijack/index.js","../../src/state.js","../../src/compiler/index.js","../../src/init.js","../../src/index.js"],"sourcesContent":["export function isObject(data) {\r\n    return typeof data === 'object' && data !== null;\r\n}\r\n//判断传入的el 是否是一个元素节点\r\nexport function isElementNode(node) {\r\n    return node.nodeType === 1;\r\n}","// 重写 数组的方法\r\nlet oldArrF = Array.prototype;\r\n\r\nconst newArrF = Object.create(oldArrF);\r\nconst F = [\r\n    'push',\r\n    'shift'\r\n]\r\nF.forEach(key=>{\r\n    newArrF[key] = function(...args){\r\n        if(key === 'push'){\r\n            console.log('调用了psuh')\r\n            //防止添加的属性是一个对象\r\n            this.__ob__.walk(args[0]);\r\n        }\r\n        // 依次对其他方法进行重写\r\n        oldArrF[key].apply(this,args);\r\n    }\r\n})\r\nexport default newArrF;","\r\nimport { isObject } from '../utils/index';\r\nimport arrMethods from './arrMethods';\r\n\r\nexport class Hijack{ //数据劫持\r\n    constructor(data){\r\n        if(!isObject(data)) throw new TypeError(\"data 的值必须是一个对象!\");\r\n        this.walk(data);\r\n    }\r\n    walk(data){\r\n        //区分数组和对象\r\n        if(Array.isArray(data)){\r\n            //将walk传给数组，等数组push... 可能会调用\r\n            data.__ob__ = this;\r\n            // 重写数组的 push shift unshift ....\r\n            data.__proto__ = arrMethods;\r\n            data.forEach(item=>{\r\n                this.walk(item);\r\n            })\r\n        }else{\r\n            //如果是对象才观察\r\n            if(data && (typeof data) == 'object'){\r\n                for(let key in data){\r\n                    this.defineRecative(data,key,data[key]);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    defineRecative(data,key,value){\r\n        let _this = this;\r\n        //递归对 对象 实现深度观察\r\n        this.walk(value);\r\n        // let dep = new Beobserver();\r\n        //观察对象属性\r\n        Object.defineProperty(data,key,{\r\n            get(){\r\n                // Beobserver.target && dep.subscribe(Beobserver.target);\r\n                return value;\r\n            },\r\n            set:(newVal)=>{\r\n                if(value != newVal){\r\n                    //防止修改的值 是一个新对象\r\n                    this.walk(newVal);\r\n                    value = newVal;\r\n                    // dep.release();\r\n                }\r\n            }\r\n        })\r\n    }\r\n}","import { Hijack } from './Hijack/index';\r\n\r\nexport function initState(vm) {\r\n    const opts = vm.$options;\r\n    // 区分vue的数据来源 \r\n    if(opts.prpos){\r\n        initPrpos(vm);\r\n    }\r\n    if(opts.data){\r\n        initData(vm);\r\n    }\r\n    if(opts.methods){\r\n        initMethods(vm);\r\n    }\r\n    if(opts.computed){\r\n        initComputed(vm);\r\n    }\r\n}\r\nfunction initPrpos(vm) {};\r\nfunction initData(vm) {\r\n    let data = vm.$options.data;\r\n    data = vm.$data = typeof data === 'function'? data.call(vm): data;\r\n    new Hijack(data);\r\n};\r\nfunction initMethods(vm) {};\r\nfunction initComputed(vm) {};","// Regular Expressions for parsing tags and attributes\r\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/\r\nconst dynamicArgAttribute = /^\\s*((?:v-[\\w-]+:|@|:|#)\\[[^=]+?\\][^\\s\"'<>\\/=]*)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/\r\nconst ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`\r\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`\r\nconst startTagOpen = new RegExp(`^<${qnameCapture}`)\r\nconst startTagClose = /^\\s*(\\/?)>/\r\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`)\r\nconst doctype = /^<!DOCTYPE [^>]+>/i\r\n\r\nfunction start(tagName, attrs){\r\n    console.log('开始标签:',tagName)\r\n    console.log('属性:',attrs)\r\n}\r\nfunction end(tagName) {\r\n    console.log('结束标签:', tagName);\r\n} \r\nfunction parseHTML(html) {\r\n    while(html){\r\n        let textEnd = html.indexOf('<');\r\n        if(textEnd === 0 ) {\r\n            let startTagMatch = parseStartTag();\r\n            if(startTagMatch){\r\n                start(startTagMatch.tagName,startTagMatch.attrs);\r\n                continue;\r\n            }\r\n            let endTagMatch = html.match(endTag);\r\n            if(endTagMatch){\r\n                advance(endTagMatch[0].length);\r\n                end(endTagMatch[1]);\r\n                continue;\r\n            }\r\n\r\n        }\r\n        let text;\r\n        if(textEnd >= 0){\r\n            text = html.substring(0,textEnd);\r\n        }\r\n        if(text){\r\n            advance(text.length);\r\n        }\r\n    }\r\n    function advance(n) {\r\n        html = html.substring(n);\r\n    }\r\n    function parseStartTag(){\r\n        let start = html.match(startTagOpen);\r\n        let match;\r\n        if(start){\r\n            match = {\r\n                tagName: start[1],\r\n                attrs: []\r\n            };\r\n            advance(start[0].length);\r\n        }\r\n        let end,attr;\r\n        while(!(end = html.match(startTagClose)) && (attr = html.match(attribute))) {\r\n            advance(attr[0].length);\r\n            match.attrs.push({\r\n                name: attr[1],\r\n                value: attr[3] || attr[4] || attr[5]\r\n            })\r\n        }\r\n        // console.log(html)\r\n        // console.log(match)\r\n        if(end){\r\n            advance(end[0].length);\r\n            return match;\r\n        }\r\n       \r\n    }\r\n}\r\n\r\nexport function compileToFn(template) {\r\n    let root = parseHTML(template);\r\n    return function render() {\r\n\r\n    }\r\n}","import { initState } from './state';\r\nimport { isElementNode } from './utils/index';\r\nimport { compileToFn } from './compiler/index';\r\n\r\nfunction initMixin(Vue){\r\n    Vue.prototype._init = function(options){\r\n        this.$options = options;\r\n        initState(this);\r\n        if(options.el){\r\n            let el = isElementNode(options.el)?options.el:document.querySelector(options.el);\r\n            this.$mount(el);\r\n        }\r\n    }\r\n    Vue.prototype.$mount = function(el) {\r\n        const vm = this;\r\n        const options = vm.$options;\r\n        let template = options.template;\r\n        if(!template){\r\n            template = el.outerHTML;\r\n        }\r\n        let render = compileToFn(template);\r\n        \r\n    }\r\n}\r\n\r\nexport default initMixin;","import initMixin from './init';\r\n\r\nfunction Vue(options) {\r\n    // console.log(options);\r\n    this._init(options);\r\n}\r\ninitMixin(Vue);\r\nexport default Vue;"],"names":["isObject","data","isElementNode","node","nodeType","oldArrF","Array","prototype","newArrF","Object","create","F","forEach","key","args","console","log","__ob__","walk","apply","Hijack","TypeError","isArray","__proto__","arrMethods","item","defineRecative","value","defineProperty","get","set","newVal","initState","vm","opts","$options","prpos","initData","methods","computed","$data","call","attribute","ncname","qnameCapture","startTagOpen","RegExp","startTagClose","endTag","start","tagName","attrs","end","parseHTML","html","textEnd","indexOf","startTagMatch","parseStartTag","endTagMatch","match","advance","length","text","substring","n","attr","push","name","compileToFn","template","root","render","initMixin","Vue","_init","options","el","document","querySelector","$mount","outerHTML"],"mappings":"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"}